{"version":3,"sources":["api/Gallery/Gallery.controller.js"],"names":["index","allGallery","deleteGallery","addNewGallery","updateGallery","formidable","require","fs","fs_extra","isImage","respondWithResult","res","statusCode","entity","status","json","handleError","err","send","req","find","_id","__v","sort","date","limit","exec","then","catch","params","serviceId","service_id","galleryId","remove","id","DeleteGallery","result","n","next","form","IncomingForm","parse","fields","files","length","title","description","sex","filetoupload","name","uuid","oldpath","path","newpath","dbpath","renameFilePath","toLowerCase","findOne","findService","move","toString","rename","GalleryNewAdd","image_url","Date","toISOString","save","InsertService","data","Error","response","update","UpdateGallery","nModified"],"mappings":";;;;;;;;;;QA4BgBA,K,GAAAA,K;QAOAC,U,GAAAA,U;QASAC,a,GAAAA,a;QA8BAC,a,GAAAA,a;QAyEAC,a,GAAAA,a;;AAnJhB;;;;AACA;;;;AACA;;;;AAEA,IAAIC,aAAaC,QAAQ,YAAR,CAAjB;AACA,IAAIC,KAAKD,QAAQ,IAAR,CAAT;AACA,IAAIE,WAAWF,QAAQ,UAAR,CAAf;AACA,MAAMG,UAAUH,QAAQ,UAAR,CAAhB;;AAGA,SAASI,iBAAT,CAA2BC,GAA3B,EAAgCC,UAAhC,EAA4C;AACxCA,iBAAaA,cAAc,GAA3B;AACA,WAAO,UAAUC,MAAV,EAAkB;AACrB,YAAIA,MAAJ,EAAY;AACR,mBAAOF,IAAIG,MAAJ,CAAWF,UAAX,EAAuBG,IAAvB,CAA4BF,MAA5B,CAAP;AACH;AACD,eAAO,IAAP;AACH,KALD;AAMH;;AAED,SAASG,WAAT,CAAqBL,GAArB,EAA0BC,UAA1B,EAAsC;AAClCA,iBAAaA,cAAc,GAA3B;AACA,WAAO,UAAUK,GAAV,EAAe;AAClBN,YAAIG,MAAJ,CAAWF,UAAX,EAAuBM,IAAvB,CAA4BD,GAA5B;AACH,KAFD;AAGH;;AAED;AACO,SAASjB,KAAT,CAAemB,GAAf,EAAoBR,GAApB,EAAyB;AAC5B,WAAO,kBAAQS,IAAR,CAAa,EAAb,EAAiB,EAACC,KAAK,CAAN,EAASC,KAAK,CAAd,EAAjB,EAAmCC,IAAnC,CAAwC,EAACC,MAAM,CAAC,CAAR,EAAxC,EAAoDC,KAApD,CAA0D,CAA1D,EAA6DC,IAA7D,GACFC,IADE,CACGjB,kBAAkBC,GAAlB,EAAuB,GAAvB,CADH,EAEFiB,KAFE,CAEIZ,YAAYL,GAAZ,CAFJ,CAAP;AAGH;;AAED;AACO,SAASV,UAAT,CAAoBkB,GAApB,EAAyBR,GAAzB,EAA8B;AACjC,QAAIQ,IAAIU,MAAJ,CAAWC,SAAf,EAA0B;AACtB,eAAO,kBAAQV,IAAR,CAAa,EAACW,YAAYZ,IAAIU,MAAJ,CAAWC,SAAxB,EAAb,EAAiD,EAACT,KAAK,CAAN,EAASC,KAAK,CAAd,EAAjD,EAAmEC,IAAnE,CAAwE,EAACC,MAAM,CAAC,CAAR,EAAxE,EAAoFE,IAApF,GACFC,IADE,CACGjB,kBAAkBC,GAAlB,EAAuB,GAAvB,CADH,EAEFiB,KAFE,CAEIZ,YAAYL,GAAZ,CAFJ,CAAP;AAGH;AACJ;;AAGM,SAAST,aAAT,CAAuBiB,GAAvB,EAA4BR,GAA5B,EAAiC;AACpC,QAAIQ,IAAIU,MAAJ,CAAWG,SAAf,EAA0B;AACtB,YAAIA,YAAYb,IAAIU,MAAJ,CAAWG,SAA3B;AACA,0BAAQC,MAAR,CAAe,EAACC,IAAIF,SAAL,EAAf,EACKN,IADL,CACU,UAAUT,GAAV,EAAekB,aAAf,EAA8B;AAChC,gBAAI,CAAClB,GAAL,EAAU;AACN,oBAAIkB,aAAJ,EAAmB;AACf,wBAAIA,cAAcC,MAAd,CAAqBC,CAArB,KAA2B,CAA/B,EAAkC;AAC9B1B,4BAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,EAACmB,IAAIF,SAAL,EAAgBI,QAAQ,sBAAxB,EADV;AAEH,qBAHD,MAGO;AACHzB,4BAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,cAAlB,EAAkC,cAAlC,CADV;AAEH;AAEJ,iBATD,MASO;AACHJ,wBAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,cAAlB,EAAkC,cAAlC,CADV;AAEH;AACJ,aAdD,MAcO;AACHJ,oBAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,GAAlB,EAAuB,2BAAvB,CADV;AAEH;AACJ,SApBL;AAqBH,KAvBD,MAuBO;AACHN,YAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,gBAAlB,EAAoC,gBAApC,CADV;AAEH;AACJ;;AAEM,SAASZ,aAAT,CAAuBgB,GAAvB,EAA4BR,GAA5B,EAAiC2B,IAAjC,EAAuC;AAC1C,QAAI;;AAEA,YAAIC,OAAO,IAAIlC,WAAWmC,YAAf,EAAX;AACAD,aAAKE,KAAL,CAAWtB,GAAX,EAAgB,UAAUF,GAAV,EAAeyB,MAAf,EAAuBC,KAAvB,EAA8B;AAC1C,gBAAI,oBAAYA,KAAZ,EAAmBC,MAAnB,GAA4B,CAA5B,IAAiCF,OAAOG,KAAxC,IAAiDH,OAAOI,WAAxD,IAAuEJ,OAAOX,UAA9E,IAA4FW,OAAOK,GAAnG,IAA0GtC,QAAQkC,MAAMK,YAAN,CAAmBC,IAA3B,CAA9G,EAAgJ;AAC5I,oBAAIC,OAAO,4BAAX;AACA,oBAAIC,UAAUR,MAAMK,YAAN,CAAmBI,IAAjC;AACA,oBAAIC,UAAU,yCAA2BD,IAA3B,GAAkCT,MAAMK,YAAN,CAAmBC,IAAnE;AACA,oBAAIK,SAAS,yCAA2BA,MAA3B,GAAoCJ,IAApC,GAA2CP,MAAMK,YAAN,CAAmBC,IAA3E;AACA,oBAAIM,iBAAiB,yCAA2BH,IAA3B,GAAkCF,IAAlC,GAAyCP,MAAMK,YAAN,CAAmBC,IAAjF;AACA,oBAAIlB,aAAaW,OAAOX,UAAxB;AACA,oBAAIc,QAAQH,OAAOG,KAAP,CAAaW,WAAb,EAAZ;AACA,oBAAIV,cAAcJ,OAAOI,WAAP,CAAmBU,WAAnB,EAAlB;AACA,oBAAIT,MAAML,OAAOK,GAAP,CAAWS,WAAX,EAAV;;AAEA,kCAAQC,OAAR,CAAgB,EAACvB,IAAIH,UAAL,EAAhB,EAAkCL,IAAlC,CAAuC,UAAUT,GAAV,EAAeyC,WAAf,EAA4B;AAC/D,wBAAIA,WAAJ,EAAiB;AACblD,iCAASmD,IAAT,CAAcR,OAAd,EAAuBE,OAAvB,EAAgC,UAAUpC,GAAV,EAAe;AAC3C,gCAAIA,GAAJ,EAAS;AACLN,oCAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,IAAI2C,QAAJ,EAAlB,EAAkC,6CAAlC,CADV;AAEH,6BAHD,MAGO;AACHrD,mCAAGsD,MAAH,CAAUR,OAAV,EAAmBE,cAAnB,EAAmC,UAAUtC,GAAV,EAAe;AAC9C,wCAAIA,GAAJ,EAAS;AACLN,4CAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkBE,IAAI2C,QAAJ,EAAlB,EAAkC,qBAAlC,CAArB;AACH,qCAFD,MAEO;AACH,4CAAIE,gBAAgB,sBAAY;AAC5B5B,gDAAI,4BADwB;AAE5BH,wDAAYA,UAFgB;AAG5BgC,uDAAWT,MAHiB;AAI5BT,mDAAOA,KAJqB;AAK5BC,yDAAaA,WALe;AAM5BtB,kDAAM,IAAIwC,IAAJ,GAAWC,WAAX,EANsB;AAO5BlB,iDAAKA;AAPuB,yCAAZ,CAApB;AASAe,sDAAcI,IAAd,GACKvC,IADL,CACU,UAAUwC,aAAV,EAAyBlD,GAAzB,EAA8B;AAChC,gDAAI,CAACA,GAAL,EAAU;AACN,oDAAIkD,aAAJ,EAAmB;AACfxD,wDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU;AACFqD,8DAAMD,aADJ;AAEF/B,gEAAQ;AAFN,qDADV;AAKH,iDAND,MAMO;AACHzB,wDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,sBAAlB,EAA0C,eAA1C,CADV;AAEH;AACJ,6CAXD,MAWO;AACHJ,oDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,GAAlB,EAAuB,2BAAvB,CADV;AAEH;AACJ,yCAjBL;AAkBH;AACJ,iCAhCD;AAiCH;AACJ,yBAvCD;AAwCH,qBAzCD,MAyCO;AACHN,4BAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,oBAAlB,EAAwC,mBAAxC,CADV;AAEH;AACJ,iBA9CD;AA+CH,aA1DD,MA0DO;AACHJ,oBAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkB,iBAAlB,EAAqC,iBAArC,CAArB;AACH;AACJ,SA9DD;AA+DH,KAlED,CAmEA,OAAOsD,KAAP,EAAc;AACV1D,YAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkBsD,MAAMT,QAAN,EAAlB,EAAoC,eAApC,CAArB;AACH;AACJ;;AAEM,SAASxD,aAAT,CAAuBe,GAAvB,EAA4BR,GAA5B,EAAiC2B,IAAjC,EAAuC;AAC1C,QAAI;AACA,YAAIC,OAAO,IAAIlC,WAAWmC,YAAf,EAAX;AACAD,aAAKE,KAAL,CAAWtB,GAAX,EAAgB,UAAUF,GAAV,EAAeyB,MAAf,EAAuBC,KAAvB,EAA8B;;AAE1C,gBAAID,OAAOG,KAAP,IAAgBH,OAAOI,WAAvB,IAAsCJ,OAAOX,UAA7C,IAA2DW,OAAOK,GAAlE,IAAyEL,OAAOR,EAApF,EAAwF;;AAEpF,oBAAIS,MAAMK,YAAN,IAAsBvC,QAAQkC,MAAMK,YAAN,CAAmBC,IAA3B,CAA1B,EAA4D;AACxD,wBAAIC,OAAO,4BAAX;AACA,wBAAIC,UAAUR,MAAMK,YAAN,CAAmBI,IAAjC;AACA,wBAAIC,UAAU,yCAA2BD,IAA3B,GAAkCT,MAAMK,YAAN,CAAmBC,IAAnE;AACA,wBAAIK,SAAS,yCAA2BA,MAA3B,GAAoCJ,IAApC,GAA2CP,MAAMK,YAAN,CAAmBC,IAA3E;AACA,wBAAIM,iBAAiB,yCAA2BH,IAA3B,GAAkCF,IAAlC,GAAyCP,MAAMK,YAAN,CAAmBC,IAAjF;AACA,wBAAIlB,aAAaW,OAAOX,UAAxB;AACA,wBAAIG,KAAKQ,OAAOR,EAAhB;AACA,wBAAIW,QAAQH,OAAOG,KAAP,CAAaW,WAAb,EAAZ;AACA,wBAAIV,cAAcJ,OAAOI,WAAP,CAAmBU,WAAnB,EAAlB;AACA,wBAAIT,MAAML,OAAOK,GAAP,CAAWS,WAAX,EAAV;;AAEA,wBAAIc,WAAW;AACXpC,0BADW;AAEXH,kCAFW;AAGXgC,mCAAWT,MAHA;AAIXT,6BAJW;AAKXC,mCALW;AAMXC;AANW,qBAAf;;AASA,sCAAQU,OAAR,CAAgB,EAACvB,IAAIH,UAAL,EAAhB,EAAkCL,IAAlC,CAAuC,UAAUT,GAAV,EAAeyC,WAAf,EAA4B;AAC/D,4BAAIA,WAAJ,EAAiB;AACblD,qCAASmD,IAAT,CAAcR,OAAd,EAAuBE,OAAvB,EAAgC,UAAUpC,GAAV,EAAe;AAC3C,oCAAIA,GAAJ,EAAS;AACLN,wCAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,IAAI2C,QAAJ,EAAlB,EAAkC,6CAAlC,CADV;AAEH,iCAHD,MAGO;AACHrD,uCAAGsD,MAAH,CAAUR,OAAV,EAAmBE,cAAnB,EAAmC,UAAUtC,GAAV,EAAe;AAC9C,4CAAIA,GAAJ,EAAS;AACLN,gDAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkBE,IAAI2C,QAAJ,EAAlB,EAAkC,qBAAlC,CAArB;AACH,yCAFD,MAEO;;AAEH,8DAAQW,MAAR,CAAe,EAACrC,IAAIA,EAAL,EAAf,EAAyB;AACrBH,4DAAYA,UADS;AAErBgC,2DAAWT,MAFU;AAGrBT,uDAAOA,KAHc;AAIrBC,6DAAaA,WAJQ;AAKrBtB,sDAAM,IAAIwC,IAAJ,GAAWC,WAAX,EALe;AAMrBlB,qDAAKA;AANgB,6CAAzB,EAOGrB,IAPH,CAOQ,UAAUT,GAAV,EAAeuD,aAAf,EAA8B;AAClC,oDAAI,CAACvD,GAAL,EAAU;AACN,wDAAIuD,aAAJ,EAAmB;AACf,4DAAIA,cAAcC,SAAd,KAA4B,CAA5B,IAAiCD,cAAcnC,CAAd,KAAoB,CAAzD,EAA4D;;AAExD1B,gEAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU;AACFqD,sEAAME,QADJ;AAEFlC,wEAAQ;AAFN,6DADV;AAMH,yDARD,MAQO;AACHzB,gEAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,kBAAlB,EAAsC,kBAAtC,CADV;AAEH;AAEJ,qDAdD,MAcO;AACHJ,4DAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,eAAlB,EAAmC,eAAnC,CADV;AAEH;AACJ,iDAnBD,MAmBO;AACHJ,wDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,GAAlB,EAAuB,2BAAvB,CADV;AAEH;AACJ,6CA/BD;AAgCH;AACJ,qCAtCD;AAuCH;AACJ,6BA7CD;AA8CH,yBA/CD,MA+CO;AACHN,gCAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,oBAAlB,EAAwC,mBAAxC,CADV;AAEH;AACJ,qBApDD;AAsDH,iBA3ED,MA2EO;;AAEH,wBAAIgB,aAAaW,OAAOX,UAAxB;AACA,wBAAIG,KAAKQ,OAAOR,EAAhB;AACA,wBAAIW,QAAQH,OAAOG,KAAP,CAAaW,WAAb,EAAZ;AACA,wBAAIV,cAAcJ,OAAOI,WAAP,CAAmBU,WAAnB,EAAlB;AACA,wBAAIT,MAAML,OAAOK,GAAP,CAAWS,WAAX,EAAV;;AAEA,wBAAIc,WAAW;AACXpC,0BADW;AAEXH,kCAFW;AAGXc,6BAHW;AAIXC,mCAJW;AAKXC;AALW,qBAAf;;AASA,sCAAQU,OAAR,CAAgB,EAACvB,IAAIH,UAAL,EAAhB,EAAkCL,IAAlC,CAAuC,UAAUT,GAAV,EAAeyC,WAAf,EAA4B;AAC/D,4BAAIA,WAAJ,EAAiB;AACb,8CAAQa,MAAR,CAAe,EAACrC,IAAIA,EAAL,EAAf,EAAyB;AACrBH,4CAAYA,UADS;AAErBc,uCAAOA,KAFc;AAGrBC,6CAAaA,WAHQ;AAIrBC,qCAAKA;AAJgB,6BAAzB,EAKGrB,IALH,CAKQ,UAAUT,GAAV,EAAeuD,aAAf,EAA8B;AAClC,oCAAI,CAACvD,GAAL,EAAU;AACN,wCAAIuD,aAAJ,EAAmB;AACf,4CAAIA,cAAcC,SAAd,KAA4B,CAA5B,IAAiCD,cAAcnC,CAAd,KAAoB,CAAzD,EAA4D;AACxD1B,gDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU;AACFqD,sDAAME,QADJ;AAEFlC,wDAAQ;AAFN,6CADV;AAMH,yCAPD,MAOO;AACHzB,gDAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,kBAAlB,EAAsC,kBAAtC,CADV;AAEH;AACJ,qCAZD,MAYO;AACHJ,4CAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,eAAlB,EAAmC,eAAnC,CADV;AAEH;AACJ,iCAjBD,MAiBO;AACHJ,wCAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkBE,GAAlB,EAAuB,2BAAvB,CADV;AAEH;AACJ,6BA3BD;AA4BH,yBA7BD,MA6BO;AACHN,gCAAIG,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,qCAAkB,oBAAlB,EAAwC,mBAAxC,CADV;AAEH;AACJ,qBAlCD;AAmCH;AACJ,aAlID,MAkIO;AACHJ,oBAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkB,iBAAlB,EAAqC,iBAArC,CAArB;AACH;AACJ,SAvID;AAwIH,KA1ID,CA2IA,OAAOsD,KAAP,EAAc;AACV1D,YAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAAkBsD,MAAMT,QAAN,EAAlB,EAAoC,eAApC,CAArB;AACH;AACJ","file":"Gallery.controller.js","sourcesContent":["import Gallery from './Gallery.model';\r\nimport Service from '../Service/Service.model';\r\nimport {errorJsonResponse, GalleryImageUploadLocation, getGuid} from '../../config/commonHelper';\r\n\r\nvar formidable = require('formidable');\r\nvar fs = require('fs');\r\nvar fs_extra = require('fs-extra');\r\nconst isImage = require('is-image');\r\n\r\n\r\nfunction respondWithResult(res, statusCode) {\r\n    statusCode = statusCode || 200;\r\n    return function (entity) {\r\n        if (entity) {\r\n            return res.status(statusCode).json(entity);\r\n        }\r\n        return null;\r\n    };\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n    statusCode = statusCode || 500;\r\n    return function (err) {\r\n        res.status(statusCode).send(err);\r\n    };\r\n}\r\n\r\n// Gets a list of Gallery\r\nexport function index(req, res) {\r\n    return Gallery.find({}, {_id: 0, __v: 0}).sort({date: -1}).limit(9).exec()\r\n        .then(respondWithResult(res, 200))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Gets all the Gallery\r\nexport function allGallery(req, res) {\r\n    if (req.params.serviceId) {\r\n        return Gallery.find({service_id: req.params.serviceId}, {_id: 0, __v: 0}).sort({date: -1}).exec()\r\n            .then(respondWithResult(res, 200))\r\n            .catch(handleError(res));\r\n    }\r\n}\r\n\r\n\r\nexport function deleteGallery(req, res) {\r\n    if (req.params.galleryId) {\r\n        let galleryId = req.params.galleryId;\r\n        Gallery.remove({id: galleryId})\r\n            .exec(function (err, DeleteGallery) {\r\n                if (!err) {\r\n                    if (DeleteGallery) {\r\n                        if (DeleteGallery.result.n === 1) {\r\n                            res.status(200)\r\n                                .json({id: galleryId, result: \"Deleted Successfully\"});\r\n                        } else {\r\n                            res.status(400)\r\n                                .json(errorJsonResponse(\"Deleted Fail\", \"Deleted Fail\"));\r\n                        }\r\n\r\n                    } else {\r\n                        res.status(400)\r\n                            .json(errorJsonResponse(\"Invalid Post\", \"Invalid Post\"));\r\n                    }\r\n                } else {\r\n                    res.status(400)\r\n                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                }\r\n            });\r\n    } else {\r\n        res.status(400)\r\n            .json(errorJsonResponse(\"Id is required\", \"Id is required\"));\r\n    }\r\n}\r\n\r\nexport function addNewGallery(req, res, next) {\r\n    try {\r\n\r\n        let form = new formidable.IncomingForm();\r\n        form.parse(req, function (err, fields, files) {\r\n            if (Object.keys(files).length > 0 && fields.title && fields.description && fields.service_id && fields.sex && isImage(files.filetoupload.name)) {\r\n                let uuid = getGuid();\r\n                let oldpath = files.filetoupload.path;\r\n                let newpath = GalleryImageUploadLocation.path + files.filetoupload.name;\r\n                let dbpath = GalleryImageUploadLocation.dbpath + uuid + files.filetoupload.name;\r\n                let renameFilePath = GalleryImageUploadLocation.path + uuid + files.filetoupload.name;\r\n                let service_id = fields.service_id;\r\n                let title = fields.title.toLowerCase();\r\n                let description = fields.description.toLowerCase();\r\n                let sex = fields.sex.toLowerCase();\r\n\r\n                Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                    if (findService) {\r\n                        fs_extra.move(oldpath, newpath, function (err) {\r\n                            if (err) {\r\n                                res.status(400)\r\n                                    .json(errorJsonResponse(err.toString(), \"Same Name Image Already Available On Server\"));\r\n                            } else {\r\n                                fs.rename(newpath, renameFilePath, function (err) {\r\n                                    if (err) {\r\n                                        res.status(400).json(errorJsonResponse(err.toString(), \"Fail to Rename file\"));\r\n                                    } else {\r\n                                        let GalleryNewAdd = new Gallery({\r\n                                            id: getGuid(),\r\n                                            service_id: service_id,\r\n                                            image_url: dbpath,\r\n                                            title: title,\r\n                                            description: description,\r\n                                            date: new Date().toISOString(),\r\n                                            sex: sex\r\n                                        });\r\n                                        GalleryNewAdd.save()\r\n                                            .then(function (InsertService, err) {\r\n                                                if (!err) {\r\n                                                    if (InsertService) {\r\n                                                        res.status(200)\r\n                                                            .json({\r\n                                                                data: InsertService,\r\n                                                                result: \"Save Successfully\"\r\n                                                            });\r\n                                                    } else {\r\n                                                        res.status(400)\r\n                                                            .json(errorJsonResponse(\"Error in db response\", \"Invalid_Image\"));\r\n                                                    }\r\n                                                } else {\r\n                                                    res.status(400)\r\n                                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                                }\r\n                                            });\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        res.status(400)\r\n                            .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                    }\r\n                });\r\n            } else {\r\n                res.status(400).json(errorJsonResponse(\"Invalid Request\", \"Invalid Request\"));\r\n            }\r\n        });\r\n    }\r\n    catch (Error) {\r\n        res.status(400).json(errorJsonResponse(Error.toString(), \"Invalid Image\"));\r\n    }\r\n}\r\n\r\nexport function updateGallery(req, res, next) {\r\n    try {\r\n        var form = new formidable.IncomingForm();\r\n        form.parse(req, function (err, fields, files) {\r\n\r\n            if (fields.title && fields.description && fields.service_id && fields.sex && fields.id) {\r\n\r\n                if (files.filetoupload && isImage(files.filetoupload.name)) {\r\n                    let uuid = getGuid();\r\n                    let oldpath = files.filetoupload.path;\r\n                    let newpath = GalleryImageUploadLocation.path + files.filetoupload.name;\r\n                    let dbpath = GalleryImageUploadLocation.dbpath + uuid + files.filetoupload.name;\r\n                    let renameFilePath = GalleryImageUploadLocation.path + uuid + files.filetoupload.name;\r\n                    let service_id = fields.service_id;\r\n                    let id = fields.id;\r\n                    let title = fields.title.toLowerCase();\r\n                    let description = fields.description.toLowerCase();\r\n                    let sex = fields.sex.toLowerCase();\r\n\r\n                    let response = {\r\n                        id,\r\n                        service_id,\r\n                        image_url: dbpath,\r\n                        title,\r\n                        description,\r\n                        sex\r\n                    };\r\n\r\n                    Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                        if (findService) {\r\n                            fs_extra.move(oldpath, newpath, function (err) {\r\n                                if (err) {\r\n                                    res.status(400)\r\n                                        .json(errorJsonResponse(err.toString(), \"Same Name Image Already Available On Server\"));\r\n                                } else {\r\n                                    fs.rename(newpath, renameFilePath, function (err) {\r\n                                        if (err) {\r\n                                            res.status(400).json(errorJsonResponse(err.toString(), \"Fail to Rename file\"));\r\n                                        } else {\r\n\r\n                                            Gallery.update({id: id}, {\r\n                                                service_id: service_id,\r\n                                                image_url: dbpath,\r\n                                                title: title,\r\n                                                description: description,\r\n                                                date: new Date().toISOString(),\r\n                                                sex: sex\r\n                                            }).exec(function (err, UpdateGallery) {\r\n                                                if (!err) {\r\n                                                    if (UpdateGallery) {\r\n                                                        if (UpdateGallery.nModified === 1 || UpdateGallery.n === 1) {\r\n\r\n                                                            res.status(200)\r\n                                                                .json({\r\n                                                                    data: response,\r\n                                                                    result: \"updated Successfully \"\r\n                                                                });\r\n\r\n                                                        } else {\r\n                                                            res.status(400)\r\n                                                                .json(errorJsonResponse(\"Record not found\", \"Record not found\"));\r\n                                                        }\r\n\r\n                                                    } else {\r\n                                                        res.status(400)\r\n                                                            .json(errorJsonResponse(\"Invalid_Image\", \"Invalid_Image\"));\r\n                                                    }\r\n                                                } else {\r\n                                                    res.status(400)\r\n                                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                                }\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                }\r\n                            });\r\n                        } else {\r\n                            res.status(400)\r\n                                .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                        }\r\n                    });\r\n\r\n                } else {\r\n\r\n                    let service_id = fields.service_id;\r\n                    let id = fields.id;\r\n                    let title = fields.title.toLowerCase();\r\n                    let description = fields.description.toLowerCase();\r\n                    let sex = fields.sex.toLowerCase();\r\n\r\n                    let response = {\r\n                        id,\r\n                        service_id,\r\n                        title,\r\n                        description,\r\n                        sex\r\n                    };\r\n\r\n\r\n                    Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                        if (findService) {\r\n                            Gallery.update({id: id}, {\r\n                                service_id: service_id,\r\n                                title: title,\r\n                                description: description,\r\n                                sex: sex\r\n                            }).exec(function (err, UpdateGallery) {\r\n                                if (!err) {\r\n                                    if (UpdateGallery) {\r\n                                        if (UpdateGallery.nModified === 1 || UpdateGallery.n === 1) {\r\n                                            res.status(200)\r\n                                                .json({\r\n                                                    data: response,\r\n                                                    result: \"updated Successfully \"\r\n                                                });\r\n\r\n                                        } else {\r\n                                            res.status(400)\r\n                                                .json(errorJsonResponse(\"Record not found\", \"Record not found\"));\r\n                                        }\r\n                                    } else {\r\n                                        res.status(400)\r\n                                            .json(errorJsonResponse(\"Invalid_Image\", \"Invalid_Image\"));\r\n                                    }\r\n                                } else {\r\n                                    res.status(400)\r\n                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                }\r\n                            });\r\n                        } else {\r\n                            res.status(400)\r\n                                .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                res.status(400).json(errorJsonResponse(\"Invalid Request\", \"Invalid Request\"));\r\n            }\r\n        });\r\n    }\r\n    catch (Error) {\r\n        res.status(400).json(errorJsonResponse(Error.toString(), \"Invalid Image\"));\r\n    }\r\n}\r\n"]}