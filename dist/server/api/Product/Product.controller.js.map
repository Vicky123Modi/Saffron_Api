{"version":3,"sources":["api/Product/Product.controller.js"],"names":["req","res","aggregate","$sort","date","exec","error","bookingProductList","i","result","all","map","Service","products","Product","teamMember","TeamMember","find","product_id","id","team","push","teamMember_id","response","bookingProduct","status","json","index","allProduct","addNewProduct","updateProduct","deleteProduct","waterfall","require","async","formidable","fs","fs_extra","isImage","respondWithResult","statusCode","entity","handleError","err","send","$unwind","then","catch","next","form","IncomingForm","reg","parse","fields","files","length","title","description","service_id","sex","price","match","offerPrice","filetoupload","name","uuid","oldpath","path","newpath","dbpath","renameFilePath","toLowerCase","findOne","findService","move","toString","rename","ProductAdd","image_url","Date","toISOString","save","InsertService","data","Error","update","UpdateProduct","nModified","n","params","productId","remove","DeleteTeamMember","DeleteTeam","$match","bookingOrder","preBookingOrder"],"mappings":"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","file":"Product.controller.js","sourcesContent":["import Product from './Product.model';\r\nimport Service from '../Service/Service.model';\r\nimport TeamMemberProduct from '../TeamMemberProduct/TeamMemberProduct.model';\r\nimport _ from 'lodash';\r\nimport {errorJsonResponse, ProductImageUploadLocation, getGuid} from '../../config/commonHelper';\r\n\r\nvar waterfall = require('async-waterfall');\r\nvar async = require('async');\r\nvar formidable = require('formidable');\r\nvar fs = require('fs');\r\nvar fs_extra = require('fs-extra');\r\nconst isImage = require('is-image');\r\n\r\nfunction respondWithResult(res, statusCode) {\r\n    statusCode = statusCode || 200;\r\n    return function (entity) {\r\n        if (entity) {\r\n            return res.status(statusCode).json(entity);\r\n        }\r\n        return null;\r\n    };\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n    statusCode = statusCode || 500;\r\n    return function (err) {\r\n        res.status(statusCode).send(err);\r\n    };\r\n}\r\n\r\n// Home Product Page\r\nexport async function index(req, res) {\r\n    return Service.aggregate({\"$unwind\": \"$id\"},\r\n        {\r\n            \"$lookup\": {\r\n                \"from\": \"products\",\r\n                \"localField\": \"id\",\r\n                \"foreignField\": \"service_id\",\r\n                \"as\": \"itemsObjects\"\r\n            }\r\n        },\r\n        {\r\n            \"$group\": {\r\n                \"_id\": \"$_id\",\r\n                \"service_id\": {\"$first\": \"$id\"},\r\n                \"image_url\": {\"$first\": \"$image_url\"},\r\n                \"title\": {\"$first\": \"$title\"},\r\n                \"description\": {\"$first\": \"$description\"},\r\n                \"date\": {\"$first\": \"$date\"},\r\n                \"products\": {\"$first\": \"$itemsObjects\"}\r\n            }\r\n        },\r\n        {$sort: {date: 1}}).exec(async (error, bookingProductList) => {\r\n\r\n        let i = 0;\r\n        let result = await Promise.all(bookingProductList.map(async (Service) => {\r\n            i++;\r\n            return await Promise.all(Service.products.map(async (Product) => {\r\n                i++;\r\n                Product.teamMember = [];\r\n                let TeamMember = await TeamMemberProduct.find({product_id: Product.id}).exec();\r\n                return await Promise.all(TeamMember.map(async (team) => {\r\n                    i++;\r\n                    Product.teamMember.push(team.teamMember_id);\r\n                    return i;\r\n                }));\r\n            }));\r\n        }));\r\n\r\n        let response = {\r\n            bookingProduct: bookingProductList\r\n        };\r\n\r\n        res.status(200).json(response);\r\n    });\r\n}\r\n\r\n// Gets a list of Products\r\nexport function allProduct(req, res) {\r\n    return Product.aggregate({\"$unwind\": \"$id\"},\r\n        {\r\n            \"$lookup\": {\r\n                \"from\": \"services\",\r\n                \"localField\": \"service_id\",\r\n                \"foreignField\": \"id\",\r\n                \"as\": \"itemsObjects\"\r\n            }\r\n        }, {\r\n            $unwind: \"$itemsObjects\"\r\n        },\r\n        {\r\n            \"$group\": {\r\n                \"_id\": \"$_id\",\r\n                \"id\": {\"$first\": \"$id\"},\r\n                \"image_url\": {\"$first\": \"$image_url\"},\r\n                \"title\": {\"$first\": \"$title\"},\r\n                \"description\": {\"$first\": \"$description\"},\r\n                \"date\": {\"$first\": \"$date\"},\r\n                \"price\": {\"$first\": \"$price\"},\r\n                \"offerPrice\": {\"$first\": \"$offerPrice\"},\r\n                \"service_id\": {\"$first\": \"$service_id\"},\r\n                \"sex\": {\"$first\": \"$sex\"},\r\n                \"service_title\": {\"$first\": \"$itemsObjects.title\"}\r\n            }\r\n        },\r\n        {$sort: {date: 1}}).exec()\r\n        .then(respondWithResult(res, 200))\r\n        .catch(handleError(res));\r\n}\r\n\r\nexport function addNewProduct(req, res, next) {\r\n    try {\r\n        let form = new formidable.IncomingForm();\r\n        let reg = /^\\d+$/;\r\n        form.parse(req, function (err, fields, files) {\r\n            if (Object.keys(files).length > 0 && fields.title && fields.description && fields.service_id && fields.sex && fields.price && fields.price.match(reg) && fields.offerPrice && fields.offerPrice.match(reg) && isImage(files.filetoupload.name)) {\r\n                let uuid = getGuid();\r\n                let oldpath = files.filetoupload.path;\r\n                let newpath = ProductImageUploadLocation.path + files.filetoupload.name;\r\n                let dbpath = ProductImageUploadLocation.dbpath + uuid + files.filetoupload.name;\r\n                let renameFilePath = ProductImageUploadLocation.path + uuid + files.filetoupload.name;\r\n                let service_id = fields.service_id;\r\n                let title = fields.title.toLowerCase();\r\n                let description = fields.description.toLowerCase();\r\n                let sex = fields.sex.toLowerCase();\r\n                let price = fields.price;\r\n                let offerPrice = fields.offerPrice;\r\n\r\n                Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                    // find the service.\r\n                    if (findService) {\r\n                        fs_extra.move(oldpath, newpath, function (err) {\r\n                            if (err) {\r\n                                res.status(400)\r\n                                    .json(errorJsonResponse(err.toString(), \"Same Name Image Already Available On Server\"));\r\n                            } else {\r\n                                fs.rename(newpath, renameFilePath, function (err) {\r\n                                    if (err) {\r\n                                        res.status(400).json(errorJsonResponse(err.toString(), \"Fail to Rename file\"));\r\n                                    } else {\r\n                                        let ProductAdd = new Product({\r\n                                            id: getGuid(),\r\n                                            service_id: service_id,\r\n                                            price: price,\r\n                                            offerPrice: offerPrice,\r\n                                            image_url: dbpath,\r\n                                            title: title,\r\n                                            description: description,\r\n                                            date: new Date().toISOString(),\r\n                                            sex: sex\r\n                                        });\r\n                                        ProductAdd.save()\r\n                                            .then(function (InsertService, err) {\r\n                                                if (!err) {\r\n                                                    if (InsertService) {\r\n                                                        res.status(200)\r\n                                                            .json({\r\n                                                                data: InsertService,\r\n                                                                result: \"Save Successfully\"\r\n                                                            });\r\n                                                    } else {\r\n                                                        res.status(400)\r\n                                                            .json(errorJsonResponse(\"Error in db response\", \"Invalid_Image\"));\r\n                                                    }\r\n                                                } else {\r\n                                                    res.status(400)\r\n                                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                                }\r\n                                            });\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        res.status(400)\r\n                            .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                    }\r\n                });\r\n            } else {\r\n                res.status(400).json(errorJsonResponse(\"Invalid Request\", \"Invalid Request\"));\r\n            }\r\n        });\r\n    }\r\n    catch (Error) {\r\n        res.status(400).json(errorJsonResponse(Error.toString(), \"Invalid Request\"));\r\n    }\r\n}\r\n\r\nexport function updateProduct(req, res, next) {\r\n    try {\r\n        var form = new formidable.IncomingForm();\r\n        form.parse(req, function (err, fields, files) {\r\n\r\n            if (fields.title && fields.description && fields.service_id && fields.sex && fields.id && fields.offerPrice && fields.price) {\r\n\r\n                let service_id = fields.service_id;\r\n                let id = fields.id;\r\n                let title = fields.title.toLowerCase();\r\n                let description = fields.description.toLowerCase();\r\n                let sex = fields.sex.toLowerCase();\r\n                let price = fields.price;\r\n                let offerPrice = fields.offerPrice;\r\n\r\n                if (files.filetoupload && isImage(files.filetoupload.name)) {\r\n                    let uuid = getGuid();\r\n                    let oldpath = files.filetoupload.path;\r\n                    let newpath = ProductImageUploadLocation.path + files.filetoupload.name;\r\n                    let dbpath = ProductImageUploadLocation.dbpath + uuid + files.filetoupload.name;\r\n                    let renameFilePath = ProductImageUploadLocation.path + uuid + files.filetoupload.name;\r\n\r\n                    let response = {\r\n                        id,\r\n                        service_id,\r\n                        image_url: dbpath,\r\n                        title,\r\n                        description,\r\n                        price,\r\n                        offerPrice,\r\n                        sex\r\n                    };\r\n\r\n                    Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                        if (findService) {\r\n                            fs_extra.move(oldpath, newpath, function (err) {\r\n                                if (err) {\r\n                                    res.status(400)\r\n                                        .json(errorJsonResponse(err.toString(), \"Same Name Image Already Available On Server\"));\r\n                                } else {\r\n                                    fs.rename(newpath, renameFilePath, function (err) {\r\n                                        if (err) {\r\n                                            res.status(400).json(errorJsonResponse(err.toString(), \"Fail to Rename file\"));\r\n                                        } else {\r\n\r\n                                            Product.update({id: id}, {\r\n                                                image_url: dbpath,\r\n                                                service_id: response.service_id,\r\n                                                price: response.price,\r\n                                                offerPrice: response.offerPrice,\r\n                                                title: response.title,\r\n                                                description: response.description,\r\n                                                sex: response.sex\r\n                                            }).exec(function (err, UpdateProduct) {\r\n                                                if (!err) {\r\n                                                    if (UpdateProduct) {\r\n                                                        if (UpdateProduct.nModified === 1 || UpdateProduct.n === 1) {\r\n\r\n                                                            res.status(200)\r\n                                                                .json({\r\n                                                                    data: response,\r\n                                                                    result: \"updated Successfully \"\r\n                                                                });\r\n\r\n                                                        } else {\r\n                                                            res.status(400)\r\n                                                                .json(errorJsonResponse(\"Record not found\", \"Record not found\"));\r\n                                                        }\r\n\r\n                                                    } else {\r\n                                                        res.status(400)\r\n                                                            .json(errorJsonResponse(\"Invalid_Image\", \"Invalid_Image\"));\r\n                                                    }\r\n                                                } else {\r\n                                                    res.status(400)\r\n                                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                                }\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                }\r\n                            });\r\n                        } else {\r\n                            res.status(400)\r\n                                .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                        }\r\n                    });\r\n\r\n                } else {\r\n\r\n                    let response = {\r\n                        id,\r\n                        service_id,\r\n                        title,\r\n                        description,\r\n                        price,\r\n                        offerPrice,\r\n                        sex\r\n                    };\r\n\r\n\r\n                    Service.findOne({id: service_id}).exec(function (err, findService) {\r\n                        if (findService) {\r\n                            Product.update({id: id}, {\r\n                                service_id: response.service_id,\r\n                                price: response.price,\r\n                                offerPrice: response.offerPrice,\r\n                                title: response.title,\r\n                                description: response.description,\r\n                                sex: response.sex\r\n                            }).exec(function (err, UpdateProduct) {\r\n                                if (!err) {\r\n                                    if (UpdateProduct) {\r\n                                        if (UpdateProduct.nModified === 1 || UpdateProduct.n === 1) {\r\n                                            res.status(200)\r\n                                                .json({\r\n                                                    data: response,\r\n                                                    result: \"updated Successfully \"\r\n                                                });\r\n\r\n                                        } else {\r\n                                            res.status(400)\r\n                                                .json(errorJsonResponse(\"Record not found\", \"Record not found\"));\r\n                                        }\r\n                                    } else {\r\n                                        res.status(400)\r\n                                            .json(errorJsonResponse(\"Invalid_Image\", \"Invalid_Image\"));\r\n                                    }\r\n                                } else {\r\n                                    res.status(400)\r\n                                        .json(errorJsonResponse(err, \"Contact to your Developer\"));\r\n                                }\r\n                            });\r\n                        } else {\r\n                            res.status(400)\r\n                                .json(errorJsonResponse(\"Service Not Found \", \"Service Not Found\"));\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                res.status(400).json(errorJsonResponse(\"Invalid Request\", \"Invalid Request\"));\r\n            }\r\n        });\r\n    }\r\n    catch (Error) {\r\n        res.status(400).json(errorJsonResponse(Error.toString(), \"Invalid Image\"));\r\n    }\r\n}\r\n\r\nexport function deleteProduct(req, res, next) {\r\n    try {\r\n        if (req.params.productId) {\r\n            let productId = req.params.productId;\r\n\r\n            //Remove All the product from TeamMember\r\n            TeamMemberProduct.remove({product_id: productId}).exec((err, DeleteTeamMember) => {\r\n                if (DeleteTeamMember) {\r\n                    Product.remove({id: productId})\r\n                        .exec(function (err, DeleteTeam) {\r\n                            if (!err) {\r\n                                if (DeleteTeam) {\r\n                                    if (DeleteTeam.result.n === 1) {\r\n                                        res.status(200)\r\n                                            .json({id: productId, result: 'Deleted Successfully'});\r\n                                    } else {\r\n                                        res.status(400)\r\n                                            .json(errorJsonResponse('Deleted Fail', 'Deleted Fail'));\r\n                                    }\r\n                                } else {\r\n                                    res.status(400)\r\n                                        .json(errorJsonResponse('Invalid Post', 'Invalid Post'));\r\n                                }\r\n                            } else {\r\n                                res.status(400)\r\n                                    .json(errorJsonResponse(err, 'Contact to your Developer'));\r\n                            }\r\n                        });\r\n                }\r\n            });\r\n        } else {\r\n            res.status(400)\r\n                .json(errorJsonResponse('Id is required', 'Id is required'));\r\n        }\r\n\r\n    } catch (error) {\r\n        res.status(400)\r\n            .json(errorJsonResponse(error, 'Contact to your Developer'));\r\n    }\r\n}\r\n\r\nexport function teamMember(req, res, next) {\r\n    try {\r\n        if (req.params.productId) {\r\n            let productId = req.params.productId;\r\n            return Product.aggregate([\r\n                {\r\n                    $match: {id: productId}\r\n                },\r\n                {\"$unwind\": \"$id\"},\r\n                {\r\n                    \"$lookup\": {\r\n                        \"from\": \"teams\",\r\n                        \"localField\": \"id\",\r\n                        \"foreignField\": \"product_id\",\r\n                        \"as\": \"TeamObjects\"\r\n                    }\r\n                },\r\n                {\r\n                    \"$group\": {\r\n                        \"_id\": \"$_id\",\r\n                        \"id\": {\"$first\": \"$id\"},\r\n                        \"title\": {\"$first\": \"$title\"},\r\n                        \"teamsMember\": {\"$first\": \"$TeamObjects\"}\r\n                    }\r\n                }\r\n            ]).exec()\r\n                .then(respondWithResult(res, 200))\r\n                .catch(handleError(res));\r\n        } else {\r\n            res.status(400)\r\n                .json(errorJsonResponse(\"Product Id is required\", \"Product Id is required\"));\r\n        }\r\n\r\n    } catch (error) {\r\n        res.status(400).json(errorJsonResponse(error, \"Contact to your Developer\"));\r\n    }\r\n}\r\n\r\nfunction bookingOrder() {\r\n    try {\r\n\r\n    } catch (Error) {\r\n\r\n    }\r\n}\r\n\r\nfunction preBookingOrder() {\r\n    return null;\r\n}\r\n"]}